#!{{ lookPath "bash" }}

set -eu

source {{ .chezmoi.workingTree }}/scripts/common.sh

{{ if eq .osid "linux-ubuntu" }}
    keybindings_path="/usr/share/doc/fzf/examples/key-bindings.zsh"
    if [ ! -f $keybindings_path ]; then
        # The key-bindings are broken in the ubuntu fzf install currently, going on 2y
        # https://bugs.launchpad.net/ubuntu/+source/fzf/+bug/1928670
        log_task "Fixing fzf key bindings in Ubuntu manually"
        sudo wget https://github.com/junegunn/fzf/raw/master/shell/key-bindings.zsh -O $keybindings_path
   fi

   log_task "Adding a symlink from fdfind to fd"
   fdfind_path=$(which fdfind)
   fd_path="$(dirname $fdfind_path)/fd"
   sudo ln -s $fdfind_path $fd_path
{{- end -}}
